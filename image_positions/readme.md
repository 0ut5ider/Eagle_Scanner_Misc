# Image Positions
This python script will generate a csv file containing positional information for all the images taken by the cameras on the Eagle scanner.
The positional (tralslation and rotation) come from the trajectory file generated by Ray Studio. 
The trajectory file contains a timestamp along with translation/rotation in a local coordinate system.
All the images captured by the eagle scanner are given filenames which are the timestamps when the image was taken. 

The script simply looks at the image filename (timestamp) and compares it to the nearest timestamp in the trajectory file. It then linearly interpoates the translations/rotations from the nearest neighbours.

### Usage
Running `python trajectory_processor.py -h` will display the available options.

Available options: 
`--trajectory /path/to/your/trajectory.txt` : File that RayStudio generates.

`--image_folder /path/to/your/images` : The location of the images folders. if you have 4 cameras, you'll have 4 folders, one for front, back, left, right images. Run the script 4 times to generate 4 output files (one for each folder of images).*

`--output_csv /path/to/output.csv` : File which contains the position information for the images. This gets imported into MEtashape.

general usage:
`python trajectory_processor.py --trajectory trajectory.txt --image_folder images --output_csv output.csv`


* currently the script does not recursively search for images in sub folders. If your Eagle has 4 cameras, you'll have to run the script 4 times and generate 4 output files in order to process images from all the front/back/left/right image folders.


Once you have generated the output.csv files, load the images into Metashape, and from the "Reference" window click the "Import Reference date" (first icon on the left).
Make sure that "Start import at row" : 2 is selected.
Make sure that Comma delimeter is used.
Make sure that the column headers match what Metashape expects buy changing the column numbers.


### Code funtion

Here's a simple description of how the code functions:

1. __Image Filename Usage__:

   - The script reads image filenames from a specified folder.
   - It extracts timestamps from the filenames using a regular expression pattern that matches the numeric timestamp format (e.g., `1734442346.592496`).

2. __Position and Rotation Interpolation__:

   - The script reads trajectory data from a CSV file, which contains position (x, y, z) and quaternion rotation values at specific timestamps.
   - For each image timestamp extracted from the filenames, the script finds the nearest timestamps in the CSV data.
   - It then calculates interpolated position (x, y, z) and rotation (roll, pitch, yaw in degrees) values based on the closest matching timestamps in the trajectory data.

3. __Output File__:

   - The processed data, including image filenames and their corresponding positions and rotations, is saved to a new CSV file.
   - By default, the output file is named `processed_trajectories.csv` and saved in the same directory as the script (`src/` by default).
