# Image Positions
This python script will generate a csv pose file containing positional information for all the images taken by the cameras on the Eagle scanner.
The positional (tralslation and rotation) come from the trajectory file generated by Ray Studio. 
The trajectory file contains a timestamp along with translation/rotation in a local coordinate system.
All the images captured by the eagle scanner are given filenames which are the timestamps when the image was taken. 

The script simply looks at the image filename (timestamp) and compares it to the nearest timestamp in the trajectory file. It then linearly interpoates the translations/rotations from the nearest neighbours.

### Dependencies

You need python to be installed.
You will also need `numpy` and `pandas to be installed.
Use `pip install numpy pandas` to install the dependencies. 

A clarification on role Metashape plays oin this scripts usage. 
- You do not need /metashape to run this script.
- This script is not meant to be run from Metashape. 
- This script is meant to be ran on it's own, in a command line or powershell terminal.

### Usage
Running `python trajectory_processor.py -h` will display the available options.

Available options: 
`--trajectory /path/to/your/trajectory.txt` : File that RayStudio generates.

`--image_folder /path/to/your/images` : The location of the images folders. RatStudio calls this folder "images".*
  
`--output_csv /path/to/pose_output.csv` : File which contains the position information for the images. This file gets imported into Metashape.

general usage:
`python trajectory_processor.py --trajectory trajectory.txt --image_folder images --output_csv pose_output.csv`

You don't have to specify each image folder individually. The script will recursivey search all sub folders for all jpg images, and use them all when generating the output pose csv file

Once you generate a csv file, follow the instructins in the [Metashape Workflows](https://github.com/0ut5ider/Eagle_Scanner_Misc/tree/main/Metashape%20workflows) page.

### Code funtion

Here's a simple description of how the code functions:

1. __Image Filename Usage__:

   - The script reads image filenames from a specified folder and searches all subfolders.
   - It extracts timestamps from the filenames using a regular expression pattern that matches the numeric timestamp format (e.g., `1734442346.592496`).

2. __Position and Rotation Interpolation__:

   - The script reads trajectory data from a CSV file, which contains position (x, y, z) and quaternion rotation values at specific timestamps.
   - For each image timestamp extracted from the filenames, the script finds the nearest timestamps in the CSV data.
   - It then calculates interpolated position (x, y, z) and values based on the closest matching timestamps in the trajectory data.

3. __Output File__:

   - The processed data, including image filenames and their corresponding positions and rotations, is saved to a new CSV file.
